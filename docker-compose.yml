version: '3'
services:
  postgres:
    image: postgres
    environment:
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_DB=${DATABASE_NAME}
    volumes:
      - teritori-data:/var/lib/postgresql/data/ # persist data even if container shuts down  
    ports:
      - "5432:5432"
  prices-postgres:
    image: postgres
    environment:
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_DB=${DATABASE_NAME}
    volumes:
      - prices-data:/var/lib/postgresql/data/ # persist data even if container shuts down  
    ports:
      - "5433:5432"
  envoy:
    image: envoyproxy/envoy:v1.28.0
    volumes:
      - ./envoy.yaml:/etc/envoy/envoy.yaml
    depends_on:
      - weshd
    ports:
      - "8080:8080"
      - "8042:8042"
      - "9901:9901"
  weshd:
    build:
      context: .
      dockerfile: ./go/cmd/weshd/Dockerfile
      platforms:
        - linux/amd64
    ports:
      - "4242:4242"
    

volumes:
  teritori-data: # named volumes can be managed easier using docker-compose
  prices-data:
